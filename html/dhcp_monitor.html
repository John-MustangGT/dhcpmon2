<!doctype html>
<html lang="en" translate="no">
  <head>
    <title>DHCP Monitor - Modern Dashboard</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>

    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --dark-bg: #1a1d29;
        --card-bg: #252936;
        --text-primary: #ffffff;
        --text-secondary: #a0a9c0;
        --border-color: #3a3f5c;
        --accent-color: #667eea;
      }

      body {
        background: var(--dark-bg);
        color: var(--text-primary);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        min-height: 100vh;
      }

      .navbar {
        background: var(--primary-gradient) !important;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .nav-tabs {
        border-bottom: 2px solid var(--border-color);
        background: var(--card-bg);
        border-radius: 12px 12px 0 0;
        padding: 1rem 1rem 0;
        margin-bottom: 0;
      }

      .nav-tabs .nav-link {
        color: var(--text-secondary);
        border: none;
        border-radius: 8px;
        margin-right: 0.5rem;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .nav-tabs .nav-link:hover {
        background: rgba(102, 126, 234, 0.1);
        color: var(--text-primary);
        transform: translateY(-2px);
      }

      .nav-tabs .nav-link.active {
        background: var(--primary-gradient);
        color: white !important;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        overflow: hidden;
      }

      .card-header {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem;
      }

      .table {
        color: var(--text-primary);
        margin-bottom: 0;
      }

      .table thead th {
        background: var(--primary-gradient);
        border: none;
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
        padding: 1rem 0.75rem;
      }

      .table tbody tr {
        border-bottom: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .table tbody tr:hover {
        background: rgba(102, 126, 234, 0.05);
        transform: scale(1.01);
      }

      .table td {
        border: none;
        padding: 1rem 0.75rem;
        vertical-align: middle;
      }

      .btn {
        border-radius: 8px;
        font-weight: 500;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
        border: none;
        position: relative;
        overflow: hidden;
      }

      .btn-primary {
        background: var(--primary-gradient);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
      }

      .btn-success {
        background: var(--success-gradient);
        box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
      }

      .btn-outline-primary {
        border: 2px solid var(--accent-color);
        color: var(--accent-color);
        background: transparent;
      }

      .btn-outline-primary:hover {
        background: var(--accent-color);
        color: white;
        transform: translateY(-2px);
      }

      .badge {
        border-radius: 20px;
        padding: 0.5rem 1rem;
        font-weight: 500;
        font-size: 0.75rem;
      }

      .badge.bg-success {
        background: var(--success-gradient) !important;
      }

      .badge.bg-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%) !important;
      }

      .mac-address, .ip-address {
        font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
        font-size: 0.9rem;
        font-weight: 500;
        background: rgba(102, 126, 234, 0.1);
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        border: 1px solid rgba(102, 126, 234, 0.2);
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 0.5rem;
        animation: pulse 2s infinite;
      }

      .status-online {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .status-static {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .status-offline {
        background: #6c757d;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }

      .control-panel {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border-color);
      }

      .search-box {
        background: rgba(102, 126, 234, 0.1);
        border: 1px solid rgba(102, 126, 234, 0.3);
        border-radius: 8px;
        color: var(--text-primary);
        padding: 0.75rem 1rem;
      }

      .search-box:focus {
        background: rgba(102, 126, 234, 0.15);
        border-color: var(--accent-color);
        color: var(--text-primary);
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .modal-content {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 16px;
      }

      .modal-header {
        border-bottom: 1px solid var(--border-color);
      }

      .form-control {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        border-radius: 8px;
      }

      .form-control:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: var(--accent-color);
        color: var(--text-primary);
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .form-label {
        color: var(--text-secondary);
        font-weight: 500;
      }

      .lease-info {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .lease-links {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.25rem;
      }

      .lease-links a {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        text-decoration: none;
        background: rgba(102, 126, 234, 0.2);
        color: var(--accent-color);
        transition: all 0.2s ease;
      }

      .lease-links a:hover {
        background: var(--accent-color);
        color: white;
      }

      .vendor-info {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
      }

      #alerts-container {
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 1050;
        width: 350px;
      }

      .alert {
        border-radius: 12px;
        border: none;
        backdrop-filter: blur(10px);
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button {
        color: var(--text-secondary) !important;
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        background: var(--primary-gradient) !important;
        border: none !important;
        color: white !important;
      }

      .dataTables_wrapper .dataTables_filter input {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        border-radius: 8px;
      }

      .dataTables_wrapper .dataTables_info {
        color: var(--text-secondary);
      }
    </style>
    <meta name="google" content="notranslate">
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="fas fa-network-wired me-2"></i>
          DHCP Monitor
        </a>
        <div class="navbar-nav ms-auto">
          <span class="navbar-text">
            <i class="fas fa-circle text-success me-1"></i>
            Online
          </span>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid" style="margin-top: 80px; padding: 2rem;">
      
      <!-- Tabs -->
      <ul class="nav nav-tabs" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="leases-tab" data-bs-toggle="tab" data-bs-target="#leases" type="button" role="tab">
            <i class="fas fa-laptop me-2"></i>DHCP Leases & Static
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="hosts-tab" data-bs-toggle="tab" data-bs-target="#hosts" type="button" role="tab">
            <i class="fas fa-address-book me-2"></i>Hosts
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab">
            <i class="fas fa-file-alt me-2"></i>Logs
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="mainTabContent">
        
        <!-- DHCP Leases Tab -->
        <div class="tab-pane fade show active" id="leases" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <div class="row align-items-center">
                <div class="col">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-network-wired me-2"></i>
                    DHCP Leases & Static Reservations
                  </h5>
                </div>
                <div class="col-auto">
                  <button class="btn btn-success btn-sm" id="add-static-btn">
                    <i class="fas fa-plus me-1"></i>Add Static Entry
                  </button>
                  <button class="btn btn-primary btn-sm ms-2" id="refresh-btn">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="leasesTable" class="table table-hover" style="width:100%">
                  <thead>
                    <tr>
                      <th>Status</th>
                      <th>IP Address</th>
                      <th>MAC Address</th>
                      <th>Hostname</th>
                      <th>Vendor</th>
                      <th>Lease Info</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Hosts Tab -->
        <div class="tab-pane fade" id="hosts" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-address-book me-2"></i>
                Host Entries
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="hostsTable" class="table table-hover" style="width:100%">
                  <thead>
                    <tr>
                      <th>IP Address</th>
                      <th>Hostname</th>
                      <th>Aliases</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Logs Tab -->
        <div class="tab-pane fade" id="logs" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-file-alt me-2"></i>
                System Logs
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="logsTable" class="table table-hover" style="width:100%">
                  <thead>
                    <tr>
                      <th>Timestamp</th>
                      <th>Channel</th>
                      <th>Message</th>
                    </tr>
                  </thead>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Alerts Container -->
    <div id="alerts-container"></div>

    <!-- Add/Edit Static Entry Modal -->
    <div class="modal fade" id="staticModal" tabindex="-1" aria-labelledby="staticModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticModalLabel">Add Static DHCP Entry</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="staticForm">
              <input type="hidden" id="entry-id">
              
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="entry-mac" class="form-label">MAC Address *</label>
                    <input type="text" class="form-control" id="entry-mac" 
                           placeholder="AA:BB:CC:DD:EE:FF" required>
                    <div class="form-text">Format: AA:BB:CC:DD:EE:FF or AA-BB-CC-DD-EE-FF</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="entry-ip" class="form-label">IP Address</label>
                    <input type="text" class="form-control" id="entry-ip" 
                           placeholder="192.168.1.100">
                    <div class="form-text">Leave empty for hostname-only reservation</div>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="entry-hostname" class="form-label">Hostname</label>
                    <input type="text" class="form-control" id="entry-hostname" 
                           placeholder="device-name">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="entry-tag" class="form-label">Network Tag</label>
                    <input type="text" class="form-control" id="entry-tag" 
                           placeholder="trusted">
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="entry-lease-time" class="form-label">Lease Time</label>
                    <input type="text" class="form-control" id="entry-lease-time" 
                           placeholder="infinite">
                    <div class="form-text">e.g., 12h, 1d, infinite</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="entry-comment" class="form-label">Comment</label>
                    <input type="text" class="form-control" id="entry-comment" 
                           placeholder="Optional comment">
                  </div>
                </div>
              </div>
              
              <div class="mb-3">
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="entry-enabled" checked>
                  <label class="form-check-label" for="entry-enabled">
                    Enable this entry
                  </label>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveStaticEntry()">Save Entry</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      let leasesTable, hostsTable, logsTable;
      
      $(document).ready(function() {
        // Initialize DataTables
        initializeTables();
        
        // Set up event handlers
        setupEventHandlers();
        
        // Load initial data
        refreshData();
        
        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);
      });

      function initializeTables() {
        // Leases Table
        leasesTable = $('#leasesTable').DataTable({
          responsive: true,
          pageLength: 25,
          order: [[1, 'asc']],
          columnDefs: [
            { orderable: false, targets: [0, 6] }
          ],
          language: {
            emptyTable: "No DHCP leases found"
          }
        });

        // Hosts Table
        hostsTable = $('#hostsTable').DataTable({
          responsive: true,
          pageLength: 25,
          ajax: {
            url: '?api=hosts.json',
            dataSrc: 'data'
          },
          columns: [
            { data: 'ip', className: 'ip-address' },
            { data: 'name' },
            { 
              data: 'alias',
              render: function(data) {
                return data ? data.join(', ') : '-';
              }
            },
            { 
              data: null,
              render: function() {
                return '<button class="btn btn-outline-primary btn-sm"><i class="fas fa-edit"></i></button>';
              }
            }
          ]
        });

        // Logs Table
        logsTable = $('#logsTable').DataTable({
          responsive: true,
          pageLength: 50,
          order: [[0, 'desc']],
          ajax: {
            url: '?api=logs.json',
            dataSrc: 'data'
          },
          columns: [
            { 
              data: 'utime',
              render: function(data) {
                return new Date(data * 1000).toLocaleString();
              }
            },
            { data: 'channel' },
            { data: 'message' }
          ]
        });
      }

      function setupEventHandlers() {
        // Add static entry button
        $('#add-static-btn').click(function() {
          showStaticModal();
        });

        // Refresh button
        $('#refresh-btn').click(function() {
          refreshData();
        });

        // Tab switching
        $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
          // Redraw tables when tab is shown
          if (e.target.id === 'hosts-tab') {
            hostsTable.ajax.reload();
          } else if (e.target.id === 'logs-tab') {
            logsTable.ajax.reload();
          }
        });
      }

      function refreshData() {
        // Load leases data
        $.ajax({
          url: '?api=leases.json',
          type: 'GET',
          dataType: 'json',
          success: function(response) {
            updateLeasesTable(response.data || []);
          },
          error: function() {
            showAlert('danger', 'Failed to load DHCP leases data');
          }
        });

        // Load static entries
        $.ajax({
          url: '/api/static',
          type: 'GET',
          dataType: 'json',
          success: function(response) {
            if (response.success) {
              updateStaticEntries(response.data || []);
            }
          },
          error: function() {
            console.log('No static entries available');
          }
        });
      }

      function updateLeasesTable(leases) {
        leasesTable.clear();
        
        leases.forEach(function(lease) {
          const statusIcon = lease.static ? 
            '<span class="status-indicator status-static"></span>Static' :
            '<span class="status-indicator status-online"></span>Dynamic';
          
          const macFormatted = formatMacAddress(lease.mac);
          
          const ipInfo = lease.ip ? 
            `<div class="lease-info">
              <span class="ip-address">${lease.ip}</span>
              <div class="lease-links">
                <a href="http://${lease.ip}" target="_blank"><i class="fas fa-globe"></i> HTTP</a>
                <a href="https://${lease.ip}" target="_blank"><i class="fas fa-lock"></i> HTTPS</a>
                <a href="ssh://${lease.ip}" target="_blank"><i class="fas fa-terminal"></i> SSH</a>
              </div>
            </div>` : '-';
          
          const vendorInfo = lease.info && lease.info.companyName ? 
            `<div>
              <div>${lease.info.companyName}</div>
              <div class="vendor-info">${lease.info.oui || ''}</div>
            </div>` : 'Unknown';
          
          const leaseInfo = lease.static ? 
            '<span class="badge bg-success">Permanent</span>' :
            `<div>
              <div><strong>Expires:</strong> ${lease.expire}</div>
              <div><strong>Remaining:</strong> ${lease.remain}</div>
            </div>`;
          
          const actions = lease.static ?
            `<div class="btn-group btn-group-sm">
              <button class="btn btn-outline-primary" onclick="editStaticEntry('${lease.id}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-outline-danger" onclick="deleteStaticEntry('${lease.id}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>` :
            `<button class="btn btn-outline-success btn-sm" onclick="makeStatic('${lease.mac}', '${lease.ip}', '${lease.name}')">
              <i class="fas fa-thumbtack"></i> Make Static
            </button>`;
          
          leasesTable.row.add([
            statusIcon,
            ipInfo,
            macFormatted,
            lease.name || '-',
            vendorInfo,
            leaseInfo,
            actions
          ]);
        });
        
        leasesTable.draw();
      }

      function updateStaticEntries(staticEntries) {
        // Static entries are already included in the main leases data
        // This function could be used for additional static-specific processing
      }

      function formatMacAddress(mac) {
        if (!mac) return '-';
        
        // Convert to uppercase and ensure consistent format
        const cleanMac = mac.toUpperCase().replace(/[:-]/g, '');
        
        // Format as AA:BB:CC:DD:EE:FF
        const formatted = cleanMac.match(/.{2}/g).join(':');
        
        return `<span class="mac-address">${formatted}</span>`;
      }

      function showStaticModal(entryData = null) {
        const modal = new bootstrap.Modal(document.getElementById('staticModal'));
        const form = document.getElementById('staticForm');
        
        if (entryData) {
          document.getElementById('staticModalLabel').textContent = 'Edit Static DHCP Entry';
          document.getElementById('entry-id').value = entryData.id;
          document.getElementById('entry-mac').value = entryData.mac || '';
          document.getElementById('entry-ip').value = entryData.ip || '';
          document.getElementById('entry-hostname').value = entryData.hostname || '';
          document.getElementById('entry-tag').value = entryData.tag || '';
          document.getElementById('entry-lease-time').value = entryData.leaseTime || '';
          document.getElementById('entry-comment').value = entryData.comment || '';
          document.getElementById('entry-enabled').checked = entryData.enabled !== false;
        } else {
          document.getElementById('staticModalLabel').textContent = 'Add Static DHCP Entry';
          form.reset();
          document.getElementById('entry-enabled').checked = true;
        }
        
        modal.show();
      }

      function saveStaticEntry() {
        const form = document.getElementById('staticForm');
        const id = document.getElementById('entry-id').value;
        
        const entry = {
          mac: document.getElementById('entry-mac').value,
          ip: document.getElementById('entry-ip').value || null,
          hostname: document.getElementById('entry-hostname').value || '',
          tag: document.getElementById('entry-tag').value || '',
          leaseTime: document.getElementById('entry-lease-time').value || '',
          comment: document.getElementById('entry-comment').value || '',
          enabled: document.getElementById('entry-enabled').checked
        };
        
        const action = id ? 'update' : 'add';
        const requestData = {
          action: action,
          entry: entry
        };
        
        if (id) {
          requestData.id = id;
        }
        
        $.ajax({
          url: '/api/static',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(requestData),
          success: function(response) {
            if (response.success) {
              const modal = bootstrap.Modal.getInstance(document.getElementById('staticModal'));
              modal.hide();
              refreshData();
              showAlert('success', response.message);
            } else {
              showAlert('danger', response.message);
            }
          },
          error: function(xhr) {
            const response = JSON.parse(xhr.responseText || '{}');
            showAlert('danger', response.message || 'An error occurred');
          }
        });
      }

      function editStaticEntry(id) {
        $.ajax({
          url: '/api/static',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({
            action: 'get',
            id: id
          }),
          success: function(response) {
            if (response.success) {
              showStaticModal(response.data);
            } else {
              showAlert('danger', response.message);
            }
          },
          error: function() {
            showAlert('danger', 'Failed to load entry data');
          }
        });
      }

      function deleteStaticEntry(id) {
        if (!confirm('Are you sure you want to delete this static DHCP entry?')) {
          return;
        }
        
        $.ajax({
          url: '/api/static',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({
            action: 'delete',
            id: id
          }),
          success: function(response) {
            if (response.success) {
              refreshData();
              showAlert('success', response.message);
            } else {
              showAlert('danger', response.message);
            }
          },
          error: function(xhr) {
            const response = JSON.parse(xhr.responseText || '{}');
            showAlert('danger', response.message || 'An error occurred');
          }
        });
      }

      function makeStatic(mac, ip, hostname) {
        const entry = {
          mac: mac,
          ip: ip,
          hostname: hostname || '',
          enabled: true
        };
        
        $.ajax({
          url: '/api/static',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({
            action: 'add',
            entry: entry
          }),
          success: function(response) {
            if (response.success) {
              refreshData();
              showAlert('success', 'Dynamic lease converted to static reservation');
            } else {
              showAlert('danger', response.message);
            }
          },
          error: function(xhr) {
            const response = JSON.parse(xhr.responseText || '{}');
            showAlert('danger', response.message || 'Failed to create static entry');
          }
        });
      }

      function showAlert(type, message) {
        const alertHtml = `
          <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        `;
        
        $('#alerts-container').append(alertHtml);
        
        // Auto-hide after 5 seconds
        setTimeout(function() {
          $('#alerts-container .alert:first').fadeOut(function() {
            $(this).remove();
          });
        }, 5000);
      }

      // Format MAC address consistently
      function normalizeMacAddress(mac) {
        if (!mac) return '';
        return mac.toUpperCase().replace(/[:-]/g, '').match(/.{2}/g).join(':');
      }

      // Validate MAC address format
      function isValidMacAddress(mac) {
        const macPattern = /^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/;
        return macPattern.test(mac);
      }

      // Validate IP address format
      function isValidIpAddress(ip) {
        if (!ip) return true; // IP is optional
        const ipPattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
        return ipPattern.test(ip);
      }

      // Add form validation
      document.getElementById('entry-mac').addEventListener('blur', function() {
        const mac = this.value;
        if (mac && !isValidMacAddress(mac)) {
          this.classList.add('is-invalid');
          showAlert('warning', 'Invalid MAC address format. Use AA:BB:CC:DD:EE:FF or AA-BB-CC-DD-EE-FF');
        } else {
          this.classList.remove('is-invalid');
          if (mac) {
            this.value = normalizeMacAddress(mac);
          }
        }
      });

      document.getElementById('entry-ip').addEventListener('blur', function() {
        const ip = this.value;
        if (ip && !isValidIpAddress(ip)) {
          this.classList.add('is-invalid');
          showAlert('warning', 'Invalid IP address format');
        } else {
          this.classList.remove('is-invalid');
        }
      });
    </script>
  </body>
</html>